<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hata Kodu Kayıt Sistemi</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <link href="./css/tailwind.css" rel="stylesheet">
    <!-- Google Apps Script Webhook URL'nizi buraya girin -->
    <script>
        const SHEETS_WEBHOOK_URL = 'https://script.google.com/macros/s/AKfycbwaIUAqUX_aq_pyZOznPlkIvppUcXarHw8LmhzCF_IVc8VkCKh9gEVIZuucwlq1xb6Z2g/exec';
    </script>
    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Arial', sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 24px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        .grid-table {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto repeat(11, auto);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-table-inner {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto repeat(8, auto);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-table-visual {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto repeat(22, auto);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-table-final {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: auto repeat(33, auto);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-table-final-outer {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto repeat(34, auto);
            gap: 1px;
            background-color: #e5e7eb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        .grid-cell {
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            padding: 12px;
            cursor: pointer;
            text-align: center;
            overflow-wrap: break-word;
            word-wrap: break-word;
            transition: background-color 0.2s, color 0.2s;
        }
        .grid-cell:hover {
            background-color: #f3f4f6;
        }
        .selected {
            background-color: #3b82f6;
            color: white;
            font-weight: bold;
        }
        .modal {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 90%;
            max-width: 400px;
            animation: slideIn 0.3s;
        }
        .info-message {
            padding: 10px 16px;
            border-radius: 8px;
            background-color: #e0f2fe;
            color: #0369a1;
            font-weight: 500;
            margin-bottom: 16px;
            text-align: center;
        }
        .error-message {
            padding: 10px 16px;
            border-radius: 8px;
            background-color: #fee2e2;
            color: #b91c1c;
            font-weight: 500;
            margin-bottom: 16px;
            text-align: center;
        }
        .success-message {
            padding: 10px 16px;
            border-radius: 8px;
            background-color: #dcfce7;
            color: #166534;
            font-weight: 500;
            margin-bottom: 16px;
            text-align: center;
        }
        .button-row {
            display: flex;
            justify-content: space-between;
            gap: 24px;
            margin-top: 24px;
        }
        button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:hover {
            transform: scale(1.05);
        }
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb;
        }
        .btn-secondary {
            background-color: #6b7280;
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563;
        }
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        .btn-danger:hover {
            background-color: #dc2626;
        }
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        .btn-success:hover {
            background-color: #059669;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }
        input:focus, select:focus {
            border-color: #3b82f6;
            outline: none;
        }
        .records-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background-color: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .records-table th {
            background-color: #3b82f6;
            color: white;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #2563eb;
        }
        .records-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .records-table tr:hover {
            background-color: #f3f4f6;
        }
        @media (max-width: 768px) {
            .card {
                padding: 16px;
            }
            .grid-table {
                grid-template-columns: 1fr;
            }
            .grid-table-inner {
                grid-template-columns: 1fr;
            }
            .grid-table-visual {
                grid-template-columns: 1fr;
            }
            .grid-table-final {
                grid-template-columns: 1fr;
            }
            .grid-table-final-outer {
                grid-template-columns: 1fr;
            }
            .grid-cell {
                padding: 8px;
            }
            .modal-content {
                width: 80%;
            }
            .records-table th, .records-table td {
                padding: 8px;
            }
            .button-row {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="root" class="min-h-screen bg-gray-100"></div>
    <script type="text/babel">
        const { useState } = React;

        const initialUsers = [
            { id: 1, sicilNo: "1001", password: "admin123" }
        ];

        const shifts = ["Sabah", "Öğle"];
        const lines = ["İç 1", "İç 2", "Dış 1", "Dış 2"];
        const operations = ["Gaz Kaçak Odası", "Performans Odası", "Görsel Kontrol", "Son Kontrol"];

        function todayString() {
            const d = new Date();
            const month = ("0" + (d.getMonth() + 1)).slice(-2);
            const day = ("0" + d.getDate()).slice(-2);
            return d.getFullYear() + "-" + month + "-" + day;
        }

        function getMainLine(line) {
            if (line.startsWith("İç")) return "İç";
            if (line.startsWith("Dış")) return "Dış";
            return "";
        }

        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [currentUser, setCurrentUser] = useState(null);
            const [users, setUsers] = useState(initialUsers);
            const [records, setRecords] = useState([]);
            const [showRegister, setShowRegister] = useState(false);
            const [showOperationScreen, setShowOperationScreen] = useState(false);
            const [showErrorCodeScreen, setShowErrorCodeScreen] = useState(false);
            const [selectedDate, setSelectedDate] = useState("");
            const [selectedShift, setSelectedShift] = useState("");
            const [selectedLine, setSelectedLine] = useState("");
            const [selectedOperation, setSelectedOperation] = useState("");
            const [globalMessage, setGlobalMessage] = useState({ type: "", text: "" });
            const [showChangeUserModal, setShowChangeUserModal] = useState(false);

            // Helper to show message for X seconds
            const showMessage = (type, text, duration = 3000) => {
                setGlobalMessage({ type, text });
                if (duration > 0) {
                    setTimeout(() => {
                        setGlobalMessage({ type: "", text: "" });
                    }, duration);
                }
            };

            const handleLogin = (sicilNo, password) => {
                const user = users.find(u => u.sicilNo === sicilNo && u.password === password);
                if (user) {
                    setIsLoggedIn(true);
                    setCurrentUser(user);
                    setGlobalMessage({ type: "", text: "" });
                } else {
                    showMessage("error", "Geçersiz sicil no veya şifre!");
                }
            };

            const handleRegister = (sicilNo, password) => {
                if (users.some(u => u.sicilNo === sicilNo)) {
                    showMessage("error", "Bu sicil no zaten kayıtlı!");
                    return;
                }
                const newUser = { id: users.length + 1, sicilNo, password };
                setUsers([...users, newUser]);
                showMessage("success", "Kayıt başarılı! Lütfen giriş yapın.");
                setShowRegister(false);
            };

            const handleLogout = () => {
                setIsLoggedIn(false);
                setCurrentUser(null);
                setShowOperationScreen(false);
                setShowErrorCodeScreen(false);
                setSelectedDate("");
                setSelectedShift("");
                setSelectedLine("");
                setSelectedOperation("");
                setGlobalMessage({ type: "", text: "" });
            };

            const handleSelectionSubmit = (date, shift, line) => {
                if (date && shift && line) {
                    setSelectedDate(date);
                    setSelectedShift(shift);
                    setSelectedLine(line);
                    setShowOperationScreen(true);
                } else {
                    showMessage("error", "Lütfen tüm alanları doldurun!");
                }
            };

            const handleOperationSubmit = (operation) => {
                if (operation) {
                    setSelectedOperation(operation);
                    setShowErrorCodeScreen(true);
                } else {
                    showMessage("error", "Lütfen bir operasyon seçin!");
                }
            };

            // Sicil değiştirme için
            const handleChangeUser = (sicilNo, password) => {
                const user = users.find(u => u.sicilNo === sicilNo && u.password === password);
                if (user) {
                    setCurrentUser(user);
                    setShowChangeUserModal(false);
                    showMessage("success", `Kullanıcı değiştirildi: ${user.sicilNo}`);
                } else {
                    showMessage("error", "Geçersiz sicil no veya şifre!");
                }
            };

            return (
                <div className="container">
                    {globalMessage.text && (
                        <div className={
                            globalMessage.type === "error"
                                ? "error-message"
                                : globalMessage.type === "success"
                                    ? "success-message"
                                    : "info-message"
                        }>
                            {globalMessage.text}
                        </div>
                    )}
                    {isLoggedIn ? (
                        showErrorCodeScreen ? (
                            <ErrorCodeScreen
                                user={currentUser}
                                date={selectedDate}
                                shift={selectedShift}
                                line={selectedLine}
                                operation={selectedOperation}
                                records={records}
                                setRecords={setRecords}
                                setShowErrorCodeScreen={setShowErrorCodeScreen}
                                onLogout={handleLogout}
                                showMessage={showMessage}
                                onChangeUser={() => setShowChangeUserModal(true)}
                            />
                        ) : showOperationScreen ? (
                            <OperationScreen
                                onSubmit={handleOperationSubmit}
                                onBack={() => setShowOperationScreen(false)}
                                onLogout={handleLogout}
                                showMessage={showMessage}
                            />
                        ) : (
                            <SelectionScreen
                                onSubmit={handleSelectionSubmit}
                                onLogout={handleLogout}
                                showMessage={showMessage}
                                lines={lines}
                            />
                        )
                    ) : (
                        showRegister ? (
                            <RegisterForm onRegister={handleRegister} setShowRegister={setShowRegister} />
                        ) : (
                            <LoginForm onLogin={handleLogin} setShowRegister={setShowRegister} />
                        )
                    )}

                    {/* Sicil No değiştir modalı */}
                    {showChangeUserModal && (
                        <ChangeUserModal
                            onSubmit={handleChangeUser}
                            onCancel={() => setShowChangeUserModal(false)}
                        />
                    )}
                </div>
            );
        };

        const LoginForm = ({ onLogin, setShowRegister }) => {
            const [sicilNo, setSicilNo] = useState("");
            const [password, setPassword] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                onLogin(sicilNo, password);
            };

            return (
                <div className="card">
                    <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">Giriş Yap</h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <input
                            type="text"
                            placeholder="Sicil No"
                            value={sicilNo}
                            onChange={(e) => setSicilNo(e.target.value)}
                            className="w-full"
                        />
                        <input
                            type="password"
                            placeholder="Şifre"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="w-full"
                        />
                        <button type="submit" className="btn-primary w-full">Giriş Yap</button>
                        <button type="button" onClick={() => setShowRegister(true)} className="w-full text-blue-500 hover:underline">
                            Kayıt Ol
                        </button>
                    </form>
                </div>
            );
        };

        const RegisterForm = ({ onRegister, setShowRegister }) => {
            const [sicilNo, setSicilNo] = useState("");
            const [password, setPassword] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                onRegister(sicilNo, password);
            };

            return (
                <div className="card">
                    <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">Kayıt Ol</h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <input
                            type="text"
                            placeholder="Sicil No"
                            value={sicilNo}
                            onChange={(e) => setSicilNo(e.target.value)}
                            className="w-full"
                        />
                        <input
                            type="password"
                            placeholder="Şifre"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="w-full"
                        />
                        <button type="submit" className="btn-success w-full">Kayıt Ol</button>
                        <button type="button" onClick={() => setShowRegister(false)} className="w-full text-blue-500 hover:underline">
                            Giriş Yap
                        </button>
                    </form>
                </div>
            );
        };

        // Sicil değiştir butonu için ek modal component
        const ChangeUserModal = ({ onSubmit, onCancel }) => {
            const [sicilNo, setSicilNo] = useState("");
            const [password, setPassword] = useState("");
            const [showPassword, setShowPassword] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(sicilNo, password);
            };

            return (
                <div className="modal">
                    <div className="modal-content">
                        <h3 className="text-lg font-bold mb-4 text-gray-800">Sicil No Değiştir</h3>
                        <form onSubmit={handleSubmit}>
                            <input
                                type="text"
                                placeholder="Sicil No"
                                value={sicilNo}
                                onChange={(e) => setSicilNo(e.target.value)}
                                className="w-full"
                            />
                            <div style={{ position: 'relative' }}>
                                <input
                                    type={showPassword ? "text" : "password"}
                                    placeholder="Şifre"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full"
                                />
                                <button
                                    type="button"
                                    style={{
                                        position: 'absolute',
                                        right: 10,
                                        top: 10,
                                        background: 'none',
                                        border: 'none',
                                        cursor: 'pointer',
                                        color: '#3b82f6'
                                    }}
                                    tabIndex={-1}
                                    onClick={() => setShowPassword(v => !v)}
                                    title="Şifreyi Göster/Gizle"
                                >
                                    {showPassword ? "Gizle" : "Göster"}
                                </button>
                            </div>
                            <div className="button-row">
                                <button type="submit" className="btn-success">Geçiş Yap</button>
                                <button type="button" className="btn-danger" onClick={onCancel}>İptal</button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // LINES props verildi
        const SelectionScreen = ({ onSubmit, onLogout, showMessage, lines }) => {
            const [date, setDate] = useState(todayString());
            const [shift, setShift] = useState("");
            const [line, setLine] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(date, shift, line);
            };

            return (
                <div className="card">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Seçim Ekranı</h2>
                        <button onClick={onLogout} className="btn-danger">Çıkış Yap</button>
                    </div>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <input
                            type="date"
                            value={date}
                            onChange={(e) => setDate(e.target.value)}
                            className="w-full"
                        />
                        <select
                            value={shift}
                            onChange={(e) => setShift(e.target.value)}
                            className="w-full"
                        >
                            <option value="">Vardiya Seç</option>
                            {shifts.map(s => (
                                <option key={s} value={s}>{s}</option>
                            ))}
                        </select>
                        <select
                            value={line}
                            onChange={(e) => setLine(e.target.value)}
                            className="w-full"
                        >
                            <option value="">Hat Seç</option>
                            {lines.map(l => (
                                <option key={l} value={l}>{l}</option>
                            ))}
                        </select>
                        <button type="submit" className="btn-primary w-full">Devam Et</button>
                    </form>
                </div>
            );
        };

        const OperationScreen = ({ onSubmit, onBack, onLogout, showMessage }) => {
            const [operation, setOperation] = useState("");

            const handleSubmit = (e) => {
                e.preventDefault();
                onSubmit(operation);
            };

            return (
                <div className="card">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Operasyon Seçimi</h2>
                        <div className="space-x-2">
                            <button onClick={onBack} className="btn-secondary">Geri</button>
                            <button onClick={onLogout} className="btn-danger">Çıkış Yap</button>
                        </div>
                    </div>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <select
                            value={operation}
                            onChange={(e) => setOperation(e.target.value)}
                            className="w-full"
                        >
                            <option value="">Operasyon Seç</option>
                            {operations.map(o => (
                                <option key={o} value={o}>{o}</option>
                            ))}
                        </select>
                        <button type="submit" className="btn-primary w-full">Devam Et</button>
                    </form>
                </div>
            );
        };

        // onChangeUser prop eklendi
        const ErrorCodeScreen = ({ user, date, shift, line, operation, records, setRecords, setShowErrorCodeScreen, onLogout, showMessage, onChangeUser }) => {
            const [currentCell, setCurrentCell] = useState("");
            const [showModal, setShowModal] = useState(false);
            const [saving, setSaving] = useState(false);
            const [lastRecord, setLastRecord] = useState(null);

            // "İç 1" ve "İç 2" => "İç"
            // "Dış 1" ve "Dış 2" => "Dış"
            const mainLine = getMainLine(line);

            // COLUMN/ROW TABLOLARI mainLine'A GÖRE
            const columns =
                mainLine === "Dış" && operation === "Gaz Kaçak Odası" 
                ? ["", "UA3+", "UL2", "U24A"]
                : mainLine === "Dış" && operation === "Son Kontrol" 
                ? ["", "UA3+", "UL2", "U24A"]
                : mainLine === "İç" && operation === "Gaz Kaçak Odası" 
                ? ["", "SJ", "SK"]
                : mainLine === "İç" && operation === "Görsel Kontrol" 
                ? ["", "SJ", "SK"]
                : mainLine === "İç" && operation === "Son Kontrol" 
                ? ["", "SJ", "SK"]
                : [];

            const rows =
                mainLine === "Dış" && operation === "Gaz Kaçak Odası" 
                ? ["", "C BORU KAÇAĞI", "KONNEKTÖR BORU KAÇAĞI", "PİNCHOFF KAÇAĞI", "ADAPTÖR KAÇAĞI", "SERVİS VANASI KAÇAĞI", 
                   "KOMPREÖR GİRİŞ BORUSU KAYNAĞI KAÇAĞI", "AKÜMÜLATÖR GİRİŞ BORUSU KAÇAĞI", "KONDANSER FİNLER ARASI KAÇAK", 
                   "GİRİŞ BORUSU KAÇAĞI", "ÇIKIŞ BORUSU KAÇAĞI"]
                : mainLine === "Dış" && operation === "Son Kontrol" 
                ? ["", "SAC - LEKELİ", "SAC - ÇİZİK", "SAC - DALMA", "SAC - ÇAPAKLI", "SAC - NOKTALAR", "SAC - BÜKÜM", 
                   "SAC - FİN EZİK", "SAC - BASKI YOK", "SAC - YAĞLI", "PLASTİK - LEKELİ", "PLASTİK - ÇİZİK", "PLASTİK - KIRIK", 
                   "PLASTİK - ÇAPAKLI", "PLASTİK - PEŞLİ", "AYAKLAR - EKSİK", "AYAKLAR - EĞİK", "AYAKLAR - PASLI", "AYAKLAR - ÇAPAKLI", 
                   "AYAKLAR - FARKLI MODELE AİT", "VİDALAR - EKSİK", "VİDALAR - RENK FARKI", "VİDALAR - UYGUNSUZ", "VİDALAR - YALAMA", 
                   "LOGO VE MATBUAT - LOGO YOK", "LOGO VE MATBUAT - LOGO BALONCUKLU", "LOGO VE MATBUAT - LOGO HATALI", 
                   "LOGO VE MATBUAT - UYARI ETİKETİ HATALI", "LOGO VE MATBUAT - TİP ETİKETİ HATALI", "LOGO VE MATBUAT - TİP ETİKETİ DÜZGÜN DEĞİL", 
                   "LOGO VE MATBUAT - SMART/DUAL ETİKETİ VAR/YOK", "KONDANSER - FİN EZİK", "KONDANSER - FİNLER ÇAPAKLI", 
                   "LOGO VE MATBUAT - FİNLER HATALI"]
                : mainLine === "İç" && operation === "Gaz Kaçak Odası" 
                ? ["", "GİRİŞ REKOR KAÇAĞI", "ÇIKIŞ REKOR KAÇAĞI", "C BORU KAÇAĞI", "U BORU KAÇAĞI", "KONNEKTÖR BORU KAÇAĞI", 
                   "EVA FİNLER ARASI KAÇAK", "KAPLİN KAÇAĞI"]
                : mainLine === "İç" && operation === "Görsel Kontrol" 
                ? [
                    "",
                    "VİDA - HAVA ÇIKIŞ VİDASI YOK",
                    "VİDA - EVA YAN KAPAK VİDASI YOK",
                    "VİDA - TOPRAKLAMA VİDASI YOK",
                    "VİDA - KAPAK VİDASI YOK - KAPAK KIRIK",
                    "VİDA - KİT GRUBU VİDASI EKSİK",
                    "EVA - EVA FİN EZİK",
                    "EVA - İZOLASYON EKSİK",
                    "EVA - U BORU EZİK",
                    "GAZ KAÇAK - C BORU KAÇAĞI",
                    "GAZ KAÇAK - REKOR KAÇAĞI",
                    "GAZ KAÇAK - PİNCH OFF KAÇAĞI",
                    "MONTAJ HATASI - KABLOLAR TOPLANMAMIŞ",
                    "MONTAJ HATASI - KAPAK OTURMAMIŞ",
                    "MONTAJ HATASI - TOPRAKLAMA KABLO YÖNÜ HATALI",
                    "MONTAJ HATASI - EVA YAN KAPAK OTURMAMIŞ",
                    "MONTAJ HATASI - KABLO KİT VE H.Ç.K ARASINA SIKIŞMIŞ",
                    "MALZEME - SU TAHLİYE HORTUMU YOK",
                    "MALZEME - HÇK YATAY KANAT ÇIKIK",
                    "MALZEME - DİSPLAY TIRNAĞI OTURMAMIŞ",
                    "MALZEME - BORU TUTUCU EKSİK",
                    "MALZEME - İONİZER KAPAĞI EKSİK"
                ]
                : mainLine === "İç" && operation === "Son Kontrol" 
                ? ["", "ÖN PANO - LEKELİ", "ÖN PANO - ÇİZİK", "ÖN PANO - DALMA", "ÖN PANO - ÇAPAKLI", "ÖN PANO - SİLİKON TAŞMASI", 
                   "ÖN PANO - BASKI HATASI", "ÖN PANO - BASKI YOK", "ÖN PANO - HAT STAMP HATALI/ÇİZİK", "YATAY KANAT - LEKELİ", 
                   "YATAY KANAT - ÇİZİK", "YATAY KANAT - KIRIK", "YATAY KANAT - ÇAPAKLI", "YATAY KANAT - PEŞLİ", "DEKOR - LEKELİ", 
                   "DEKOR - ÇİZİK", "DEKOR - KIRIK", "DEKOR - ÇAPAKLI", "DEKOR - PEŞLİ", "DEKOR - FARKLI MODELE AİT", "DEKOR - BASKI HATALI", 
                   "DEKOR - BASKI YOK", "MATBUAT - TİP ETİKETİ HATALI", "MATBUAT - TİP ETİKETİ FARKLI MODELE AİT", "MATBUAT - ÜRÜN ETİKETİ HATALI", 
                   "MATBUAT - ÜRÜN ETİKETİ FARKLI MODELE AİT", "MONTAJ HATALARI - DEKOR OTURMAMIŞ", "MONTAJ HATALARI - PANO VİDASI SIKILMAMIŞ/EKSİK", 
                   "MONTAJ HATALARI - BANTLAR EKSİK", "MONTAJ HATALARI - ARKA FİLTRE OTURMAMIŞ", "MONTAJ HATALARI - PANO TIRNAKLARI OTURMAMIŞ", 
                   "MONTAJ HATALARI - TİP ETİKETİ ÇİZİK/YAMUK", "MONTAJ HATALARI - TEKNİK KART EKSİK/HATALI"]
                : [];

            const gridClass =
                mainLine === "Dış" && operation === "Gaz Kaçak Odası" ? "grid-table" 
                : mainLine === "Dış" && operation === "Son Kontrol" ? "grid-table-final-outer" 
                : mainLine === "İç" && (operation === "Gaz Kaçak Odası" || operation === "Son Kontrol") ? "grid-table-final" 
                : mainLine === "İç" && operation === "Görsel Kontrol" ? "grid-table-visual" 
                : "grid-table-inner";

            const handleCellClick = (row, col) => {
                if (row !== "" && col !== "") {
                    setCurrentCell({ row, col, rowIndex: rows.indexOf(row), colIndex: columns.indexOf(col) });
                    setShowModal(true);
                }
            };

            // GOOGLE SHEETS ENTEGRASYONLU KAYIT
            const handleConfirm = async (confirm) => {
                if (confirm && currentCell) {
                    setSaving(true);
                    setShowModal(false);

                    setTimeout(async () => {
                        const { row, col } = currentCell;
                        const newRecord = {
                            id: records.length + 1,
                            date,
                            shift,
                            line,
                            operation,
                            sicilNo: user.sicilNo,
                            hata: row,
                            sasi: col
                        };
                        setRecords([...records, newRecord]);
                        setSaving(false);
                        setLastRecord(newRecord);
                        setCurrentCell("");
                        setTimeout(() => setLastRecord(null), 2000);

                        // Google Sheets'e kayıt gönder
                        try {
                            const response = await fetch(SHEETS_WEBHOOK_URL, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    sicilNo: newRecord.sicilNo,
                                    date: newRecord.date,
                                    shift: newRecord.shift,
                                    line: newRecord.line,
                                    operation: newRecord.operation,
                                    sasi: newRecord.sasi,
                                    hata: newRecord.hata
                                })
                            });
                            const result = await response.json();
                            if (result.result !== "success") {
                                showMessage("error", "Google Sheets'e kayıt gönderilemedi: " + (result.message || ""));
                            }
                        } catch (err) {
                            showMessage("error", "Google Sheets'e kayıt gönderilemedi: " + err.message);
                        }
                    }, 750);
                } else {
                    setShowModal(false);
                    setCurrentCell("");
                }
            };

            return (
                <div className="card">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold text-gray-800">Hücre Seçimi Ekranı</h2>
                        <div className="space-x-2 flex items-center">
                            <button onClick={() => setShowErrorCodeScreen(false)} className="btn-secondary">Geri</button>
                            <button onClick={onChangeUser} className="btn-primary">Sicil No Değiştir</button>
                            <button onClick={onLogout} className="btn-danger">Çıkış Yap</button>
                        </div>
                    </div>
                    <div className="mb-6 text-gray-600">
                        <p><strong>Tarih:</strong> {date}</p>
                        <p><strong>Vardiya:</strong> {shift}</p>
                        <p><strong>Hat:</strong> {line}</p>
                        <p><strong>Operasyon:</strong> {operation}</p>
                        <p><strong>Sicil No:</strong> {user.sicilNo}</p>
                    </div>
                    <div className="space-y-4">
                        <div className="p-4 bg-gray-50 rounded-lg">
                            <h3 className="text-lg font-bold mb-4 text-gray-800">Hücre Seçimi</h3>
                            {saving && (
                                <div className="info-message">
                                    Kaydediliyor...
                                </div>
                            )}
                            {lastRecord && (
                                <div className="success-message">
                                    Kayıt başarılı: {lastRecord.hata} - {lastRecord.sasi}
                                </div>
                            )}
                            <div className={gridClass}>
                                {rows.map((row, rowIndex) => (
                                    columns.map((col, colIndex) => (
                                        <div
                                            key={`${row}-${col}`}
                                            className={`grid-cell ${currentCell && currentCell.row === row && currentCell.col === col ? 'selected' : ''}`}
                                            onClick={() => handleCellClick(row, col)}
                                        >
                                            {row === "" && col === "" ? "" : row === "" ? col : col === "" ? row : ""}
                                        </div>
                                    ))
                                ))}
                            </div>
                            {showModal && (
                                <div className="modal">
                                    <div className="modal-content">
                                        <p className="text-gray-800">Seçilen hücre: {currentCell.row}-{currentCell.col}. Onaylıyor musunuz?</p>
                                        <div className="button-row">
                                            <button onClick={() => handleConfirm(true)} className="btn-success">Evet</button>
                                            <button onClick={() => handleConfirm(false)} className="btn-danger">Hayır</button>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                    <div className="mt-8">
                        <h3 className="text-xl font-bold mb-4 text-gray-800">Kayıtlar</h3>
                        {records.length > 0 ? (
                            <table className="records-table">
                                <thead>
                                    <tr>
                                        <th>Sicil No</th>
                                        <th>Tarih</th>
                                        <th>Vardiya</th>
                                        <th>Hat</th>
                                        <th>Operasyon</th>
                                        <th>Şasi</th>
                                        <th>Hata</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {records.map(record => (
                                        <tr key={record.id}>
                                            <td>{record.sicilNo}</td>
                                            <td>{record.date}</td>
                                            <td>{record.shift}</td>
                                            <td>{record.line}</td>
                                            <td>{record.operation}</td>
                                            <td>{record.sasi}</td>
                                            <td>{record.hata}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        ) : (
                            <p className="text-gray-500">Henüz kayıt yok.</p>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
